<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% seo %}
    <link rel="stylesheet" href="{{ "/assets/css/style.css?v=" | append: site.github.build_revision | relative_url }}">

    <style>
      body {
        cursor: none;
      }

      .cursor {
        position: fixed;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background: rgba(20,20,20,0.9);
        pointer-events: none;
        transform: translate(-50%, -50%);
        z-index: 9999;
      }

      #antigravityCanvas {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 0;
      }

      .wrapper {
        position: relative;
        z-index: 1;
      }
    </style>

    {% include head-custom.html %}
  </head>

  <body>
    <div class="cursor"></div>
    <canvas id="antigravityCanvas"></canvas>

    <div class="wrapper">
      <header>
        <h1><a href="{{ "/" | absolute_url }}">{{ site.title | default: site.github.repository_name }}</a></h1>
        <p>{{ site.description | default: site.github.project_tagline }}</p>
      </header>

      <section>
        {{ content }}
      </section>

      <footer>
        <p><small>Hosted on GitHub Pages</small></p>
      </footer>
    </div>

    <script src="{{ "/assets/js/scale.fix.js" | relative_url }}"></script>

    <!-- Oceanic Antigravity Field -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {

        /* ---------- Canvas ---------- */
        const canvas = document.getElementById("antigravityCanvas");
        const ctx = canvas.getContext("2d");

        function resize() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener("resize", resize);

        /* ---------- Cursor ---------- */
        const cursor = document.querySelector(".cursor");

        /* ---------- Mouse ---------- */
        const mouse = {
          x: canvas.width / 2,
          y: canvas.height / 2,
          vx: 0,
          vy: 0
        };

        let last = { x: mouse.x, y: mouse.y };

        document.addEventListener("mousemove", e => {
          mouse.x = e.clientX;
          mouse.y = e.clientY;
          mouse.vx = mouse.x - last.x;
          mouse.vy = mouse.y - last.y;
          last.x = mouse.x;
          last.y = mouse.y;

          cursor.style.left = mouse.x + "px";
          cursor.style.top = mouse.y + "px";
        });

        /* ---------- Color Palette ---------- */
        const palette = [
          [88,101,242],
          [52,211,153],
          [96,165,250],
          [250,204,21],
          [244,114,182],
          [167,139,250]
        ];

        const lerp = (a,b,t) => a + (b-a)*t;

        function oceanColor(angle, dist, wave) {
          // Inner calm zone (white â†’ gray)
          if (dist < 90) {
            const g = Math.floor(lerp(245, 180, dist / 90));
            return `rgba(${g},${g},${g},0.85)`;
          }

          // Outer chromatic field
          const idx = Math.floor((angle / (Math.PI * 2)) * palette.length);
          const next = (idx + 1) % palette.length;
          const t = (Math.sin(wave) + 1) / 2;

          return `rgba(
            ${lerp(palette[idx][0], palette[next][0], t)},
            ${lerp(palette[idx][1], palette[next][1], t)},
            ${lerp(palette[idx][2], palette[next][2], t)},
            0.75
          )`;
        }

        /* ---------- Particles ---------- */
        const particles = [];
        const COUNT = 520;

        class Particle {
          constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.vx = 0;
            this.vy = 0;
            this.phase = Math.random() * Math.PI * 2;
            this.size = Math.random() * 2 + 1;
          }

          update(time) {
            const dx = this.x - mouse.x;
            const dy = this.y - mouse.y;
            const dist = Math.sqrt(dx*dx + dy*dy) + 0.001;

            /* ---- Wave propagation ---- */
            const wave =
              Math.sin(dist * 0.035 - time * 0.004 + this.phase);

            // Direction-normalized
            const nx = dx / dist;
            const ny = dy / dist;

            // Pressure wave force (ocean-like)
            const pressure = wave * 0.4;

            this.vx += nx * pressure;
            this.vy += ny * pressure;

            /* ---- Cursor movement injects swell ---- */
            this.vx += mouse.vx * 0.015;
            this.vy += mouse.vy * 0.015;

            /* ---- Ambient drift ---- */
            this.vx += Math.sin(time * 0.001 + this.phase) * 0.02;
            this.vy += Math.cos(time * 0.001 + this.phase) * 0.02;

            /* ---- Damping ---- */
            this.vx *= 0.92;
            this.vy *= 0.92;

            this.x += this.vx;
            this.y += this.vy;

            // Wrap edges
            if (this.x < 0) this.x = canvas.width;
            if (this.x > canvas.width) this.x = 0;
            if (this.y < 0) this.y = canvas.height;
            if (this.y > canvas.height) this.y = 0;
          }

          draw(time) {
            const dx = this.x - mouse.x;
            const dy = this.y - mouse.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const angle = Math.atan2(dy, dx) + Math.PI;

            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fillStyle = oceanColor(angle, dist, time * 0.004 + this.phase);
            ctx.fill();
          }
        }

        for (let i = 0; i < COUNT; i++) {
          particles.push(new Particle());
        }

        /* ---------- Animation ---------- */
        function animate(time) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          particles.forEach(p => {
            p.update(time);
            p.draw(time);
          });
          requestAnimationFrame(animate);
        }

        animate(0);
      });
    </script>
  </body>
</html>
